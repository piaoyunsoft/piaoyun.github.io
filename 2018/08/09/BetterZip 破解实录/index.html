<!DOCTYPE HTML>
<html lang="">
<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="优雅人生">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <link rel="dns-prefetch" href="http://piaoyunsoft.github.io">
    <!--SEO-->





<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />
    <!--Title-->


<title>BetterZip 破解实录 | 优雅人生</title>


    <link rel="alternate" href="/atom.xml" title="优雅人生" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    





    

</head>


<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  style="background-image:url(img/banner.jpg)"  >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='PiaoYun'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
        	<!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
                 <img src="/img/branding.png" alt="Snippet 博客主题" class="img-responsive center-block">
            
    	</div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://piaoyunsoft.github.io">优雅人生</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>Home</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/iOS/"><i class="fa "></i>iOS</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/macOS/"><i class="fa "></i>macOS</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/Android/"><i class="fa "></i>Android</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/Python/"><i class="fa "></i>Python</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/go/"><i class="fa "></i>go</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/archives/"><i class="fa "></i>时间轴</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="BetterZip 破解实录">
            
	            BetterZip 破解实录
            
        </h1>
        <div class="post-meta">
    
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a href="/categories/macOS">
            macOS
        </a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
                
            
        </span>
    </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2018/08/09</span>
        </span>
    
</div>

            
            
    </div>
    
    <div class="post-body post-content">
        <h1 id="BetterZip-破解实录"><a href="#BetterZip-破解实录" class="headerlink" title="BetterZip 破解实录"></a>BetterZip 破解实录</h1><h2 id="目标介绍"><a href="#目标介绍" class="headerlink" title="目标介绍"></a>目标介绍</h2><p>BetterZip是一款功能强大的压缩软件，不必解压就能快速地检查压缩文档。它能执行文件之间的合并并提供密码。使用它，用户可以更快捷的向压缩文件中添加和删除文件。它支持包括zip、gz、bz、bz2、tar、tgz、tbz、rar、7-zip、cpio、 arj、lha、lhz、cab、iso、chm、rpm、deb、nsis、sit、dd、hqx和bin等多种格式的文件。此外，它还能让文件在Windows 和Linux系统中兼容。BetterZip是Mac平台比较有名的压缩解压缩软件，类似于windows平台的Winrar。最新的V2版本功能比较强大，全面支持64Bit .支持如下多种格式. ZIP, SIT, TAR, GZip, BZip2, RAR, 7-Zip, CPIO, ARJ,LZH/LHA, JAR, WAR, CAB, ISO, CHM, RPM, DEB, NSIS, BIN, HQX等。</p>
<h2 id="所需工具"><a href="#所需工具" class="headerlink" title="所需工具"></a>所需工具</h2><ul>
<li>IDA Pro/Hopper Disassembler</li>
<li>LLDB</li>
<li>010 Editor</li>
<li>Xcode</li>
<li>OpenSSL</li>
</ul>
<h2 id="寻找切入点"><a href="#寻找切入点" class="headerlink" title="寻找切入点"></a>寻找切入点</h2><p>通过IDA 搜索关键字，锁定了一个可疑函数：<br><img src="/media/15337997348143.jpg" alt=""></p>
<p>LLDB下断、在注册界面随便输入注册码，如期断下：<br><img src="/media/15337999387411.jpg" alt=""></p>
<h2 id="算法分析"><a href="#算法分析" class="headerlink" title="算法分析"></a>算法分析</h2><h3 id="解码RSA公钥"><a href="#解码RSA公钥" class="headerlink" title="解码RSA公钥"></a>解码RSA公钥</h3><p>这里可以看到RSA公钥的base64解码过程、以及确定使用了OpenSSL库:<br><img src="/media/15337999646250.jpg" alt=""></p>
<h3 id="RSA公钥解密注册码"><a href="#RSA公钥解密注册码" class="headerlink" title="RSA公钥解密注册码"></a>RSA公钥解密注册码</h3><p>这里可以看到用了RSA公钥解密注册码，从mov edi, 80h 可以推断出使用了RSA1024<br><img src="/media/15338000064886.jpg" alt=""></p>
<h3 id="注册码第一部分：起始特征字"><a href="#注册码第一部分：起始特征字" class="headerlink" title="注册码第一部分：起始特征字"></a>注册码第一部分：起始特征字</h3><p>注册码开头必须为：<strong>MAS_BetterZp2_、</strong>MIB_BZ-Friend_、__MIB_BetterZip_:<br><img src="/media/15338000435002.jpg" alt=""></p>
<h3 id="注册码第二部分：7字节整数"><a href="#注册码第二部分：7字节整数" class="headerlink" title="注册码第二部分：7字节整数"></a>注册码第二部分：7字节整数</h3><p>这里看到从第0x10字节开始取了7字节，然后转换为int值，黑名单检测稍后分析:<br><img src="/media/15338000700552.jpg" alt=""></p>
<h3 id="注册码第三部分：4字节整数"><a href="#注册码第三部分：4字节整数" class="headerlink" title="注册码第三部分：4字节整数"></a>注册码第三部分：4字节整数</h3><p>这里看到从第0x23字节开始取了4字节，然后转换为int值:<br><img src="/media/15338000967442.jpg" alt=""></p>
<h3 id="注册码第4部分：任意可视字符"><a href="#注册码第4部分：任意可视字符" class="headerlink" title="注册码第4部分：任意可视字符"></a>注册码第4部分：任意可视字符</h3><p>这里看到从第0x29字节开始，取得剩下的字符串，根据后面分析可知，是用户名:<br><img src="/media/15338001202873.jpg" alt=""></p>
<h3 id="最后的显示部分"><a href="#最后的显示部分" class="headerlink" title="最后的显示部分"></a>最后的显示部分</h3><p>显示注册码部分，有3处分支，我们选取了显示参数最多的一处，略显逼格，哈！！:<br><img src="/media/15338001421335.jpg" alt=""></p>
<h3 id="算法总结"><a href="#算法总结" class="headerlink" title="算法总结"></a>算法总结</h3><ul>
<li>第一部分 <strong>MAS_BetterZp2_、</strong>MIB_BZ-Friend_、__MIB_BetterZip_  占0x10字节</li>
<li>留空1字节</li>
<li>第二部分  [0x10, 7]  7字节整数  随机生成(需要避免黑名单)</li>
<li>留空1字节</li>
<li>第三部分  [0x23, 4] 4字节整数 随机生成即可</li>
<li>留空1字节</li>
<li>第四部分 [0x29, …] 用户名 自己看着办</li>
</ul>
<p>因为下标从0开始，根据取值区间来看，需要留空一个字节</p>
<blockquote>
<p><strong>样本注册内容：__MIB_BetterZip_0999999 2999-12-32 9999 <a href="http://www.chinapyg.com" target="_blank" rel="noopener">www.chinapyg.com</a></strong></p>
</blockquote>
<h2 id="黑名单检测"><a href="#黑名单检测" class="headerlink" title="黑名单检测"></a>黑名单检测</h2><p>###检测代码<br>可以看到这里取了算法第二部分的7字节转换的整数，进行黑名单检测:<br><img src="/media/15338002781799.jpg" alt=""></p>
<h3 id="黑名单列表"><a href="#黑名单列表" class="headerlink" title="黑名单列表"></a>黑名单列表</h3><p><img src="/media/15338002956920.jpg" alt=""></p>
<h2 id="Patch公钥"><a href="#Patch公钥" class="headerlink" title="Patch公钥"></a>Patch公钥</h2><h3 id="生成公私钥对"><a href="#生成公私钥对" class="headerlink" title="生成公私钥对"></a>生成公私钥对</h3><p>私钥：openssl genrsa -out rsa_private_key.pem  1024<br>公钥：openssl rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem<br><img src="/media/15338003502085.jpg" alt=""></p>
<h3 id="对公钥进行base64编码"><a href="#对公钥进行base64编码" class="headerlink" title="对公钥进行base64编码"></a>对公钥进行base64编码</h3><p><img src="/media/15338003681488.jpg" alt=""></p>
<h3 id="替换公钥字符串"><a href="#替换公钥字符串" class="headerlink" title="替换公钥字符串"></a>替换公钥字符串</h3><p>下面是替换前、后的图片：<br><img src="/media/15338004006307.jpg" alt=""><br><img src="/media/15338004091738.jpg" alt=""></p>
<h2 id="签名校验"><a href="#签名校验" class="headerlink" title="签名校验"></a>签名校验</h2><p>通过对公钥的交叉引用，我们发现了一处签名校验：<br><img src="/media/15338004421460.jpg" alt=""><br>非常简单的验证公钥的第0x40字节，如果不等于0x55 则over！<br>经creantan版主分析，此处不为0x55的概率非常低 ，所以几乎可以忽略此签名校验。</p>
<h2 id="KeyGen"><a href="#KeyGen" class="headerlink" title="KeyGen"></a>KeyGen</h2><p>采用go语言编写的注册机：<br><img src="/media/15338004771066.jpg" alt=""></p>
<h2 id="胜利截图"><a href="#胜利截图" class="headerlink" title="胜利截图"></a>胜利截图</h2><p>最后是注册成功的截图：<br><img src="/media/15338005040223.jpg" alt=""></p>

    </div>

    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">优雅人生</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
    
        <a href="/2018/08/08/iOS10 无法使用NSLog输出日志，解决方案/" class="next-post btn btn-default" title='iOS10 无法使用NSLog输出日志，解决方案'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">iOS10 无法使用NSLog输出日志，解决方案</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
    
    <div id="vcomments" class="valine"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>

    <script>
        new Valine({
            av: AV,
            el: '#vcomments',
            appId: 'xOKV9J4UeQAtVkvnJC7Kq2Jn-gzGzoHsz',
            appKey: 'erIpQac4azoCmgfBB7Dl9maa',
            placeholder: '说点什么吧',
            notify: false,
            verify: false,
            avatar: 'mm',
            meta: 'nick,mail'.split(','),
            pageSize: '10',
            path: window.location.pathname,
            lang: ''.toLowerCase()
        })
    </script>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">Table of Contents</h3>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#BetterZip-破解实录"><span class="toc-text">BetterZip 破解实录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#目标介绍"><span class="toc-text">目标介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#所需工具"><span class="toc-text">所需工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#寻找切入点"><span class="toc-text">寻找切入点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#算法分析"><span class="toc-text">算法分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#解码RSA公钥"><span class="toc-text">解码RSA公钥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RSA公钥解密注册码"><span class="toc-text">RSA公钥解密注册码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#注册码第一部分：起始特征字"><span class="toc-text">注册码第一部分：起始特征字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#注册码第二部分：7字节整数"><span class="toc-text">注册码第二部分：7字节整数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#注册码第三部分：4字节整数"><span class="toc-text">注册码第三部分：4字节整数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#注册码第4部分：任意可视字符"><span class="toc-text">注册码第4部分：任意可视字符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#最后的显示部分"><span class="toc-text">最后的显示部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#算法总结"><span class="toc-text">算法总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#黑名单检测"><span class="toc-text">黑名单检测</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#黑名单列表"><span class="toc-text">黑名单列表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Patch公钥"><span class="toc-text">Patch公钥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#生成公私钥对"><span class="toc-text">生成公私钥对</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#对公钥进行base64编码"><span class="toc-text">对公钥进行base64编码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#替换公钥字符串"><span class="toc-text">替换公钥字符串</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#签名校验"><span class="toc-text">签名校验</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KeyGen"><span class="toc-text">KeyGen</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#胜利截图"><span class="toc-text">胜利截图</span></a></li></ol></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12"> 
                <span>Copyright &copy; 2017
                </span> | 
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> | 
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



<script src="/js/app.js?rev=@@hash"></script>


</body>
</html>